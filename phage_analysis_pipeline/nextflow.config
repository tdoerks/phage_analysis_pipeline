// Nextflow configuration for K-State Beocat HPC
params {
    // Input parameters
    assemblies = "path/to/your/assemblies/*.fasta"
    outdir = "results"
    
    // Database parameters
    prophage_db_url = "https://prophage-db.s3.amazonaws.com/prophage_db.dmnd"
    
    // Resource limits
    max_memory = '100.GB'
    max_cpus = 16
    max_time = '24.h'
}

// Apptainer configuration
apptainer {
    enabled = true
    autoMounts = true
    cacheDir = "$HOME/.apptainer/cache"
}

// Slurm executor configuration
executor {
    name = 'slurm'
    queueSize = 50
}

// Process-specific configurations
process {
    executor = 'slurm'
    
    // Default resources with killable option
    memory = '32.GB'
    cpus = 8
    time = '4.h'
    clusterOptions = '--gres=killable:0'
    
    // Process-specific resource allocation
    withName: 'VIBRANT' {
        container = 'quay.io/biocontainers/vibrant:1.2.1--pyhdfd78af_1'
        memory = '64.GB'
        cpus = 16
        time = '12.h'
    }
    
    withName: 'DIAMOND_PROPHAGE' {
        container = 'quay.io/biocontainers/diamond:2.1.8--h43eeafb_0'
        memory = '32.GB'
        cpus = 16
        time = '8.h'
    }
    
    withName: 'CHECKV' {
        container = 'quay.io/biocontainers/checkv:1.0.1--pyhdfd78af_0'
        memory = '16.GB'
        cpus = 4
        time = '2.h'
    }
    
    withName: 'PHANOTATE' {
        container = 'quay.io/biocontainers/phanotate:1.5.0--pyhdfd78af_0'
        memory = '8.GB'
        cpus = 4
        time = '2.h'
    }
    
    withName: 'COMBINE_RESULTS' {
        container = 'quay.io/biocontainers/pandas:1.5.3'
        memory = '16.GB'
        cpus = 2
        time = '1.h'
    }
    
    // High-memory processes without killable option
    withName: 'DOWNLOAD_PROPHAGE_DB' {
        container = 'quay.io/biocontainers/wget:1.20.3'
        memory = '100.GB'
        cpus = 16
        time = '24.h'
        clusterOptions = ''  // Remove killable for critical downloads
    }
}

// Capture execution reports
timeline {
    enabled = true
    file = "${params.outdir}/pipeline_info/execution_timeline.html"
}
report {
    enabled = true
    file = "${params.outdir}/pipeline_info/execution_report.html"
}
trace {
    enabled = true
    file = "${params.outdir}/pipeline_info/execution_trace.txt"
}
dag {
    enabled = true
    file = "${params.outdir}/pipeline_info/pipeline_dag.svg"
}

// Error handling
process.shell = ['/bin/bash', '-euo', 'pipefail']